from ultralytics import YOLO

def main():
    # üîπ ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≤‡∏Å best.pt (‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏£‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏£‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô)
    model = YOLO("best.pt")

    # üîπ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ó‡∏£‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏• (fine-tune)
    model.train(
        data="food-detect-8/data.yaml",   # path ‡πÑ‡∏õ‡∏¢‡∏±‡∏á dataset
        epochs=200,                       # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏ô
        imgsz=960,                        # ‡∏Ç‡∏ô‡∏≤‡∏î‡∏†‡∏≤‡∏û‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏£‡∏ô (‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô = ‡πÅ‡∏°‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô)
        batch=8,                          # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏†‡∏≤‡∏û‡∏ï‡πà‡∏≠ batch (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö VRAM 6GB)
        device="cuda",                    # ‡πÉ‡∏ä‡πâ GPU ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
        name="food_detect_model_v2",      # ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡πÄ‡∏ó‡∏£‡∏ô
        workers=4,                        # ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô thread ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        amp=True,                         # ‡πÉ‡∏ä‡πâ Automatic Mixed Precision ‡πÄ‡∏ó‡∏£‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏Å‡∏¥‡∏ô VRAM ‡∏ô‡πâ‡∏≠‡∏¢
        augment=True,                     # ‡πÄ‡∏õ‡∏¥‡∏î data augmentation ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢
        hsv_h=0.015, hsv_s=0.7, hsv_v=0.4,  # ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á‡∏™‡∏µ
        degrees=5.0, translate=0.1, scale=0.8, shear=0.2, flipud=0.1, fliplr=0.5,  # ‡∏´‡∏°‡∏∏‡∏ô/‡∏û‡∏•‡∏¥‡∏Å/‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢
        lr0=0.0003,                       # ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô learning rate (‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡∏∂‡πâ‡∏ô)
        lrf=0.01,                         # ‡∏Ñ‡πà‡∏≤ learning rate ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏£‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏à‡∏ö
        momentum=0.937,                   # ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£
        weight_decay=0.0005,              # ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô overfitting
        patience=100,                     # ‡∏ñ‡πâ‡∏≤ val loss ‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 100 ‡∏£‡∏≠‡∏ö ‡∏à‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏≠‡∏á
        val=True,                         # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ epoch
        seed=42,                          # ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏•‡πÄ‡∏ó‡∏£‡∏ô‡∏ã‡πâ‡∏≥‡πÑ‡∏î‡πâ
        cos_lr=True,                      # ‡πÉ‡∏ä‡πâ Cosine learning rate
        cache=True,                       # ‡πÇ‡∏´‡∏•‡∏î dataset ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô RAM ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏£‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
        resume=False                      # ‡πÑ‡∏°‡πà resume ‡∏à‡∏≤‡∏Å session ‡πÄ‡∏î‡∏¥‡∏°
    )


if __name__ == "__main__":
    main()
